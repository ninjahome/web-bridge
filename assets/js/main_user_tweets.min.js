const cachedUserTweets=new MemCachedTweets;function __myPostOrVotedTweetsStatus(e){document.getElementById("tweets-post-by-user").style.display=e?"block":"none";document.getElementById("tweets-voted-by-user").style.display=e?"none":"block";document.querySelector("#tweet-detail").style.display="none";const t=document.getElementById("my-vote-or-post-tweet-switch-area");t.querySelectorAll(".top-topic-btn").forEach((e=>e.classList.remove("active"))),e?t.querySelector(".my-posted-tweets").classList.add("active"):t.querySelector(".my-voted-tweets").classList.add("active")}async function loadTweetsUserPosted(){try{curScrollContentID=2,showWaiting("loading..."),__myPostOrVotedTweetsStatus(!0),await __loadTweetAtUserPost(!0,ninjaUserObj.eth_addr,cachedUserTweets,fillUserPostedTweetsList)}catch(e){console.log(e),showDialog(DLevel.Warning,e.toString())}finally{hideLoading()}}async function olderPostedTweets(){if(0!==cachedUserTweets.latestID)return __loadTweetAtUserPost(!1,ninjaUserObj.eth_addr,cachedUserTweets,fillUserPostedTweetsList);console.log("no need to load older posted data")}async function __loadTweetAtUserPost(e,t,o,s){const a=new TweetQueryParam(0,t,[]);await TweetsQuery(a,e,o)&&(await s(0===a.start_id),o.CachedItem=[])}function __checkPayment(e,t){if(t.payment_status!==TXStatus.NoPay)return;const o=e.querySelector(".tweetPaymentRetry"),s=e.querySelector(".tweetPaymentDelete");o.classList.add("show"),o.onclick=()=>procPaymentForPostedTweet(t,(function(e,t){__globalTweetMemCache.set(e.create_time,e),e.payment_status===TXStatus.Success&&(o.classList.remove("show"),s.classList.remove("show"),updatePaymentStatusToSrv(e,t).then())})),s.classList.add("show"),s.onclick=()=>removeUnPaidTweets(t.create_time).then((e=>{if(!e)return;const o="tweet-card-for-user-"+t.create_time,s=document.getElementById(o);s&&s.parentNode.removeChild(s)}))}async function removeUnPaidTweets(e){try{return showWaiting("deleting tweet......"),await PostToSrvByJson("/removeUnpaidTweet",{create_time:e,status:TXStatus.NoPay}),__globalTweetMemCache.delete(e),!0}catch(e){return showDialog(DLevel.Error,"remove unpaid tweet failed:"+e.toString()),!1}finally{hideLoading()}}async function fillUserPostedTweetsList(e){return __fillNormalTweet(e,"tweets-post-by-user",cachedUserTweets.CachedItem,"tweetTemplateForUserSelf","tweet-card-for-user-",!1,TweetDetailSource.NoNeed,(function(e,t,o){e.querySelector(".vote-number").textContent=o.vote_count,e.querySelector(".tweet-content").style.cursor="default",__checkPayment(e,o)}))}async function loadTweetsUserVoted(){try{curScrollContentID=22,showWaiting("loading..."),__myPostOrVotedTweetsStatus(!1),await __loadTweetIDsUserVoted(!0,ninjaUserObj.eth_addr,cachedUserVotedTweets,cachedVoteStatusForUser,fillUserVotedTweetsList)}catch(e){console.log(e),showDialog(e.toString())}finally{hideLoading()}}async function olderVotedTweets(){if(console.log("lod old data trigger"),0!==cachedUserVotedTweets.latestID)return __loadTweetIDsUserVoted(!1,ninjaUserObj.eth_addr,cachedUserVotedTweets,cachedVoteStatusForUser,fillUserVotedTweetsList);console.log("no need to load older data")}const cachedUserVotedTweets=new MemCachedTweets,cachedVoteStatusForUser=new Map;async function __loadTweetIDsUserVoted(e,t,o,s,a){const r=new TweetQueryParam(0,t,[]);e||(r.start_id=o.latestID);const n=await PostToSrvByJson("/votedTweetIds",r);if(!n||0===n.length)return void(e||(o.moreOldTweets=!1));const c=[];n.forEach((e=>{s.set(e.create_time,e.vote_count),c.push(e.create_time)}));const d=new TweetQueryParam(0,"",c);await TweetsQuery(d,e,o)&&a&&await a(e),o.CachedItem=[]}async function fillUserVotedTweetsList(e){return __fillNormalTweet(e,"tweets-voted-by-user",cachedUserVotedTweets.CachedItem,"tweetTemplateForVoted","tweet-card-for-vote-",!0,TweetDetailSource.MyVoted,(function(e,t,o){e.querySelector(".total-vote-number").textContent=o.vote_count;e.querySelector(".user-vote-number").textContent=cachedVoteStatusForUser.get(o.create_time)??0,__showVoteButton(e,o)}))}async function showUserProfile(e){if(e.eth_addr===ninjaUserObj.eth_addr)return void showDialog(DLevel.Tips,"This is yourself");currentNinjaUsrLoading=e;const t=document.getElementById("nj-user-profile");let o;t.style.display="block",document.querySelectorAll(".content-in-middle-area").forEach((e=>{e.classList.contains("active")&&(o=e),e.classList.remove("active")})),t.querySelector(".back-button").onclick=function(){o&&o.classList.add("active"),t.style.display="none"},t.querySelector(".web3id").textContent=e.eth_addr;const s=t.querySelector(".tweet-header-in-profile");await __setOnlyHeader(s,e.tw_id,e.eth_addr),await loadPostedTweetsOfNjUsr()}const cachedNinjaUserPostedTweets=new MemCachedTweets;async function olderNinjaUsrPostedTweets(){await __loadTweetAtUserPost(!1,currentNinjaUsrLoading.eth_addr,cachedNinjaUserPostedTweets,fillNinjaUserPostedTweetsList)}function __njUserVoteOrPostedTweetsStatus(e){document.getElementById("nj-user-posted-tweets").style.display=e?"block":"none";document.getElementById("nj-user-vote-tweets").style.display=e?"none":"block";const t=document.getElementById("twee-switch-area-for-nj-user");t.querySelectorAll(".top-topic-btn").forEach((e=>e.classList.remove("active"))),e?t.querySelector(".tweetsPostedByNjUser").classList.add("active"):t.querySelector(".tweetsVotedNjUser").classList.add("active")}async function loadPostedTweetsOfNjUsr(){showWaiting("loading"),curScrollContentID=51,__njUserVoteOrPostedTweetsStatus(!0),await __loadTweetAtUserPost(!0,currentNinjaUsrLoading.eth_addr,cachedNinjaUserPostedTweets,fillNinjaUserPostedTweetsList),hideLoading()}async function fillNinjaUserPostedTweetsList(e){return __fillNormalTweet(e,"nj-user-posted-tweets",cachedNinjaUserPostedTweets.CachedItem,"tweetTemplateForNjUsrProfile","tweet-card-for-njusr-post-",!1,TweetDetailSource.NoNeed,(function(e,t,o){e.querySelector(".total-vote-count").textContent=o.vote_count,e.querySelector(".tweet-content").style.cursor="default",e.querySelector(".vote-count").style.display="none",__showVoteButton(e,o)}))}const cachedNinjaUserVotedTweets=new MemCachedTweets,cachedNinjaVoteStatusForUser=new Map;let currentNinjaUsrLoading=null;async function olderNinjaUsrVotedTweets(){await __loadTweetIDsUserVoted(!1,currentNinjaUsrLoading.eth_addr,cachedNinjaUserVotedTweets,cachedNinjaVoteStatusForUser,fillNinjaUserVotedTweetsList)}async function loadVotedTweetsOfNjUsr(){showWaiting("loading"),curScrollContentID=52,__njUserVoteOrPostedTweetsStatus(!1),await __loadTweetIDsUserVoted(!0,currentNinjaUsrLoading.eth_addr,cachedNinjaUserVotedTweets,cachedNinjaVoteStatusForUser,fillNinjaUserVotedTweetsList),hideLoading()}async function fillNinjaUserVotedTweetsList(e){return __fillNormalTweet(e,"nj-user-vote-tweets",cachedNinjaUserVotedTweets.CachedItem,"tweetTemplateForNjUsrProfile","tweet-card-for-njusr-vote-",!1,TweetDetailSource.NoNeed,(function(e,t,o){e.querySelector(".total-vote-count").textContent=o.vote_count,e.querySelector(".tweet-content").style.cursor="default";e.querySelector(".nj-user-vote-count").textContent=cachedNinjaVoteStatusForUser.get(o.create_time)??0,__showVoteButton(e,o)}))}