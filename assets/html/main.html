<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ninja User Info</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <script src="/assets/js/abi_tweet_vote.js"></script>
    <script src="/assets/js/abi_game_lottery.js"></script>
    <script src="/assets/js/utils.js"></script>
    <script src="/assets/js/main_class.js"></script>
    <script src="/assets/js/main_common.js"></script>
    <script src="/assets/js/main_metamask.js"></script>
    <script src="/assets/js/main_nj.js"></script>
    <script src="/assets/js/main_twitter.js"></script>
    <style>
        .container {
            display: flex; /* 启用flex布局 */
            height: 100vh; /* 容器高度设置为视窗高度 */
        }

        .left-menu-area {
            flex: 1; /* 左边菜单区域占据剩余空间的一部分 */
            background-color: #f4f4f4; /* 背景色，可根据需要调整 */
            padding: 10px; /* 内边距 */
        }

        .middle-content-area {
            flex: 3; /* 中间主要内容区域占据剩余空间的两部分 */
            background-color: #fff; /* 背景色，可根据需要调整 */
            padding: 10px; /* 内边距 */
            border-left: 1px solid #ddd; /* 左边框线 */
            border-right: 1px solid #ddd; /* 右边框线 */
        }

        .right-operation-area {
            flex: 1; /* 右边操作区域占据剩余空间的一部分 */
            background-color: #f4f4f4; /* 背景色，可根据需要调整 */
            padding: 10px; /* 内边距 */
        }

        .menu-list-left-area {
            list-style: none;
            padding: 0;
        }

        .menu-item-left-area {
            padding: 10px;
            cursor: pointer;
            color: #333; /* 默认颜色 */
        }

        .menu-item-left-area:hover {
            background-color: #a7a7af; /* 鼠标悬停时的颜色 */
        }

        .menu-item-left-area.active {
            color: #1DA1F2; /* 被选中的菜单项颜色 */
        }

        .content-in-middle-area {
            display: none; /* 默认隐藏所有内容 */
        }

        .content-in-middle-area.active {
            display: block; /* 显示激活的内容 */
        }



        .tweets-park {
            flex-grow: 1.618;
            background-color: #e6e6e6;
            margin-bottom: 20px;
        }

        .tweet-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .tweet-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .tweet-header .name {
            font-weight: bold;
        }

        .tweet-header .username {
            color: #555;
            margin-left: 5px;
        }

        .tweet-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tweet-footer .tweet-action {
            display: flex;
            align-items: center;
        }

        .tweet-card {
            min-height: 100px;
            max-height: 400px;
            overflow: hidden;
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
            transition: max-height 0.3s ease;
        }

        .tweet-footer .tweet-info {
            font-style: italic;
        }

        .tweet-action button {
            background-color: #4CAF50;
            color: white;
            padding: 6px 12px;
            margin: 4px 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tweet-action button:hover {
            background-color: #45a049;
        }

        .show-more {
            background-color: #4CAF50;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-align: center;
            display: block;
            margin: 10px auto;
        }

        .show-more:hover {
            background-color: #45a049;
        }

        .tweet-content {
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tweet-content-collapsed {
            overflow: hidden;
            cursor: pointer;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
        }
        .tweetPaymentRetry {
            display: none;
            background-color: #f44336; /* 例如，红色背景 */
            color: white;
            padding: 6px 12px;
            margin: 4px 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .tweetPaymentRetry.show {
            display: inline-block;
        }
    </style>
</head>
<body>
<div class="container">

    <div class="left-menu-area">
        <img src="/assets/file/logo.png" style="width: 40px;height: 40px" alt="avatar">

        <ul class="menu-list-left-area">
            <li onclick="menuOnClicked.call(this)" class="menu-item-left-area active" data-content="middle-div-home">
                主页
            </li>
            <li onclick="menuOnClicked.call(this)" class="menu-item-left-area" data-content="middle-div-leaderboard">
                排行榜
            </li>
            <li onclick="menuOnClicked.call(this)" class="menu-item-left-area" data-content="middle-div-web3">Web3身份
            </li>
            <li onclick="menuOnClicked.call(this)" class="menu-item-left-area" data-content="middle-div-income">
                我的收入
            </li>
            <li onclick="menuOnClicked.call(this)" class="menu-item-left-area" data-content="middle-div-settings">设置
            </li>
            <li onclick="openKolKeyPage()" class="menu-item-left-area" data-content="middle-div-userKolKey">
                我的Key
            </li>
        </ul>
        <div class="left-top-tweet-post-area">
            <label for="tweets">
            <textarea class="tweets-content-txt-area" id="tweets-content-txt-area">
            </textarea>
            </label>
            <button id="tweet-post-with-eth-btn" onclick="postTweet()">发布推文</button>
        </div>
    </div>
    <div class="middle-content-area">
        <div id="middle-div-home" class="content-in-middle-area active">
            <div id="tweetTemplate" class="tweet-card" style="display: none;">
                <div class="tweet-header" onmouseenter="showHoverCard.call(this)"
                     onmouseleave="hideHoverCard.call(this)">
                    <img src="" alt="Avatar" class="twitterAvatar">
                    <span class="name twitterName"></span>
                    <span class="username twitterUserName"></span>
                    <span class="time tweetCreateTime"></span>
                </div>
                <div onclick="showTweetDetails.call(this)" class="tweet-content tweet-content-collapsed"></div>
                <button class="show-more" onclick="showFullTweetContent.call(this)">更多</button>
                <div class="tweet-footer">
                    <div class="tweet-action">
                        <button class="tweet-action-vote">0.01 eth打赏</button>
                    </div>
                    <div class="tweet-info">
                        <span class="vote-count">投票数: <span class="vote-number">0</span></span>
                        Payment Status: <span class="tweetPaymentStatus"></span>
                        <button class="tweetPaymentRetry" >继续支付</button>
                    </div>
                </div>
            </div>
            <div class="tweets-park"> </div>
        </div>

        <div id="middle-div-leaderboard" class="content-in-middle-area">排行榜内容</div>
        <div id="middle-div-web3" class="content-in-middle-area">Web3身份内容</div>
        <div id="middle-div-income" class="content-in-middle-area">我的收入内容</div>
        <div id="middle-div-settings" class="content-in-middle-area">设置内容</div>
        <div id="middle-div-userKolKey" class="content-in-middle-area">我的Key内容</div>
    </div>

{{/*    <div class="right-operation-area">*/}}
{{/*        <div id="web3-environment-operate-area" class="web3-environment-operate-area"*/}}
{{/*             style="display: block;background: #a7a7af">*/}}
{{/*            <button id="bridge-to-twitter" style="display: block" onclick="bindingTwitter()">绑定twitter</button>*/}}
{{/*            <button id="switch-to-arbitrum" style="display: block" onclick="switchToWorkChain()">切换到Arb网络</button>*/}}
{{/*        </div>*/}}
{{/*    </div>*/}}
</div>

<div class="hover-card" id="hover-card" onmouseleave="hideHoverCard(this)">
    <img src="" alt="Avatar" id="hover-avatar">
    <div class="hover-card-content">
        <div id="hover-name"></div>
        <div>推文总数: <span id="hover-tweet-count"></span></div>
        <div>投票数: <span id="hover-vote-count"></span></div>
    </div>
    <button class="buy-key-button">购买Key</button>
</div>

<div id="vote-no-chose-modal" class="vote-chose-modal-class">
    <div class="vote-no-modal-content">
        <div class="vote-no-modal-header">
            <span class="vote-no-close" onclick="closeVoteModal()">&times;</span>
            <h2>推文投票</h2>
        </div>
        <div class="vote-no-modal-body">
            <p>票数：<input type="number" id="voteCount" value="1" min="1"></p>
            <button id="decreaseVote" onclick="decreaseVote()">-</button>
            <button id="increaseVote" onclick="increaseVote()">+</button>
        </div>
        <div class="vote-no-modal-footer">
            <button id="cancelButton" onclick="closeVoteModal()">取消</button>
            <button id="confirmButton" onclick="confirmVoteModal()">确定</button>
        </div>
    </div>
</div>

<script>
    let ninjaUserObj = {{ .NinjaUsrInfoJson }};
    document.addEventListener("DOMContentLoaded", initMainPage);

    async function initMainPage() {
        checkTwitterID();
        await checkMetaMaskEnvironment();
        loadLatestTweet(true);
    }

    function menuOnClicked() {
        document.querySelectorAll('.menu-item-left-area').forEach(i => i.classList.remove('active'));
        this.classList.add('active');

        const contentId = this.getAttribute('data-content');
        document.querySelectorAll('.content-in-middle-area').forEach(c => c.classList.remove('active'));

        document.getElementById(contentId).classList.add('active');
    }

    function openKolKeyPage() {
        window.location.href = "/kol_key";
    }
</script>
</body>
</html>